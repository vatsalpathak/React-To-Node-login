{"version":3,"file":"okta-react.umd.js","sources":["../../src/OktaContext.ts","../../src/SecureRoute.tsx","../../src/OktaError.tsx","../../src/LoginCallback.tsx","../../src/Security.tsx","../../src/withOktaAuth.tsx"],"sourcesContent":["/*\n * Copyright (c) 2020-Present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\nimport * as React from 'react';\nimport { AuthState, OktaAuth } from '@okta/okta-auth-js';\n\nexport type OnAuthRequiredFunction = (oktaAuth: OktaAuth) => Promise<void> | void;\nexport type OnAuthResumeFunction = () => void;\n\nexport type RestoreOriginalUriFunction = (oktaAuth: OktaAuth, originalUri: string) => Promise<void> | void;\n\nexport interface IOktaContext {\n    oktaAuth: OktaAuth;\n    authState: AuthState | null;\n    _onAuthRequired?: OnAuthRequiredFunction;\n}\n\nconst OktaContext = React.createContext<IOktaContext | null>(null);\n\nexport const useOktaAuth = (): IOktaContext => React.useContext(OktaContext) as IOktaContext;\n\nexport default OktaContext;\n","/*\n * Copyright (c) 2017-Present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport * as React from 'react';\nimport { useOktaAuth, OnAuthRequiredFunction } from './OktaContext';\nimport * as ReactRouterDom from 'react-router-dom';\nimport { toRelativeUrl, AuthSdkError } from '@okta/okta-auth-js';\nimport OktaError from './OktaError';\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nlet useMatch: any;\nif ('useRouteMatch' in ReactRouterDom) {\n  // trick static analyzer to avoid \"'useRouteMatch' is not exported\" error\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  useMatch = (ReactRouterDom as any)['useRouteMatch' in ReactRouterDom ? 'useRouteMatch' : ''];\n} else {\n  // throw when useMatch is triggered\n  useMatch = () => { \n    throw new AuthSdkError('Unsupported: SecureRoute only works with react-router-dom v5 or any router library with compatible APIs. See examples under the \"samples\" folder for how to implement your own custom SecureRoute Component.');\n  };\n}\n\nconst SecureRoute: React.FC<{\n  onAuthRequired?: OnAuthRequiredFunction;\n  errorComponent?: React.ComponentType<{ error: Error }>;\n} & ReactRouterDom.RouteProps & React.HTMLAttributes<HTMLDivElement>> = ({ \n  onAuthRequired,\n  errorComponent,\n  ...routeProps\n}) => { \n  const { oktaAuth, authState, _onAuthRequired } = useOktaAuth();\n  const match = useMatch(routeProps);\n  const pendingLogin = React.useRef(false);\n  const [handleLoginError, setHandleLoginError] = React.useState<Error | null>(null);\n  const ErrorReporter = errorComponent || OktaError;\n\n  React.useEffect(() => {\n    const handleLogin = async () => {\n      if (pendingLogin.current) {\n        return;\n      }\n\n      pendingLogin.current = true;\n\n      const originalUri = toRelativeUrl(window.location.href, window.location.origin);\n      oktaAuth.setOriginalUri(originalUri);\n      const onAuthRequiredFn = onAuthRequired || _onAuthRequired;\n      if (onAuthRequiredFn) {\n        await onAuthRequiredFn(oktaAuth);\n      } else {\n        await oktaAuth.signInWithRedirect();\n      }\n    };\n\n    // Only process logic if the route matches\n    if (!match) {\n      return;\n    }\n\n    if (!authState) {\n      return;\n    }\n\n    if (authState.isAuthenticated) {\n      pendingLogin.current = false;\n      return;\n    }\n\n    // Start login if app has decided it is not logged in and there is no pending signin\n    if(!authState.isAuthenticated) { \n      handleLogin().catch(err => {\n        setHandleLoginError(err as Error);\n      });\n    }  \n\n  }, [\n    authState,\n    oktaAuth, \n    match, \n    onAuthRequired, \n    _onAuthRequired\n  ]);\n\n  if (handleLoginError) {\n    return <ErrorReporter error={handleLoginError} />;\n  }\n\n  if (!authState || !authState.isAuthenticated) {\n    return null;\n  }\n\n  return (\n    <ReactRouterDom.Route\n      { ...routeProps }\n    />\n  );\n};\n\nexport default SecureRoute;\n","/*\n * Copyright (c) 2020-Present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport * as React from 'react';\n\nconst OktaError: React.FC<{ error: Error }> = ({ error }) => { \n  if(error.name && error.message) { \n    return <p>{error.name}: {error.message}</p>;\n  }\n  return <p>Error: {error.toString()}</p>;\n};\n\nexport default OktaError;\n","/*\n * Copyright (c) 2017-Present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport * as React from 'react';\nimport { useOktaAuth, OnAuthResumeFunction } from './OktaContext';\nimport OktaError from './OktaError';\n\ninterface LoginCallbackProps {\n  errorComponent?: React.ComponentType<{ error: Error }>;\n  onAuthResume?: OnAuthResumeFunction;\n  loadingElement?: React.ReactElement;\n}\n\nconst LoginCallback: React.FC<LoginCallbackProps> = ({ errorComponent, loadingElement = null, onAuthResume }) => { \n  const { oktaAuth, authState } = useOktaAuth();\n  const [callbackError, setCallbackError] = React.useState(null);\n\n  const ErrorReporter = errorComponent || OktaError;\n  React.useEffect(() => {\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore OKTA-464505: backward compatibility support for auth-js@5\n    const isInteractionRequired = oktaAuth.idx.isInteractionRequired || oktaAuth.isInteractionRequired.bind(oktaAuth);\n    if (onAuthResume && isInteractionRequired()) {\n      onAuthResume();\n      return;\n    }\n    oktaAuth.handleLoginRedirect().catch(e => {\n      setCallbackError(e);\n    });\n  }, [oktaAuth]);\n\n  const authError = authState?.error;\n  const displayError = callbackError || authError;\n  if (displayError) { \n    return <ErrorReporter error={displayError}/>;\n  }\n\n  return loadingElement;\n};\n\nexport default LoginCallback;\n","/*!\n * Copyright (c) 2017-Present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport * as React from 'react';\nimport { AuthSdkError, AuthState, OktaAuth } from '@okta/okta-auth-js';\nimport OktaContext, { OnAuthRequiredFunction, RestoreOriginalUriFunction } from './OktaContext';\nimport OktaError from './OktaError';\nimport { compare as compareVersions } from 'compare-versions';\n\ndeclare const AUTH_JS: {\n  minSupportedVersion: string;\n}\n\ndeclare const PACKAGE_NAME: string;\ndeclare const PACKAGE_VERSION: string;\ndeclare const SKIP_VERSION_CHECK: string;\n\nconst Security: React.FC<{\n  oktaAuth: OktaAuth,\n  restoreOriginalUri: RestoreOriginalUriFunction, \n  onAuthRequired?: OnAuthRequiredFunction,\n  children?: React.ReactNode\n} & React.HTMLAttributes<HTMLDivElement>> = ({ \n  oktaAuth,\n  restoreOriginalUri, \n  onAuthRequired, \n  children\n}) => { \n  const [authState, setAuthState] = React.useState(() => {\n    if (!oktaAuth) {\n      return null;\n    }\n    return oktaAuth.authStateManager.getAuthState();\n  });\n\n  React.useEffect(() => {\n    if (!oktaAuth || !restoreOriginalUri) {\n      return;\n    }\n\n    // Add default restoreOriginalUri callback\n    // props.restoreOriginalUri is required, therefore if options.restoreOriginalUri exists, there are 2 callbacks\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    if (oktaAuth.options.restoreOriginalUri) {\n      console.warn('Two custom restoreOriginalUri callbacks are detected. The one from the OktaAuth configuration will be overridden by the provided restoreOriginalUri prop from the Security component.');\n    }\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    oktaAuth.options.restoreOriginalUri = (async (oktaAuth: unknown, originalUri: string) => {\n      restoreOriginalUri(oktaAuth as OktaAuth, originalUri);\n    }) as ((oktaAuth: OktaAuth, originalUri?: string) => Promise<void>);\n\n  }, []); // empty array, only check on component mount\n\n  React.useEffect(() => {\n    if (!oktaAuth) {\n      return;\n    }\n\n    // Add okta-react userAgent\n    if (oktaAuth._oktaUserAgent) {\n      oktaAuth._oktaUserAgent.addEnvironment(`${PACKAGE_NAME}/${PACKAGE_VERSION}`);\n    } else {\n      console.warn('_oktaUserAgent is not available on auth SDK instance. Please use okta-auth-js@^5.3.1 .');\n    }\n\n    // Update Security provider with latest authState\n    const currentAuthState = oktaAuth.authStateManager.getAuthState();\n    if (currentAuthState !== authState) {\n      setAuthState(currentAuthState);\n    }\n    const handler = (authState: AuthState) => {\n      setAuthState(authState);\n    };\n    oktaAuth.authStateManager.subscribe(handler);\n\n    // Trigger an initial change event to make sure authState is latest\n    oktaAuth.start();\n\n    return () => {\n      oktaAuth.authStateManager.unsubscribe(handler);\n    };\n  }, [oktaAuth]);\n\n  if (!oktaAuth) {\n    const err = new AuthSdkError('No oktaAuth instance passed to Security Component.');\n    return <OktaError error={err} />;\n  }\n\n  if (!restoreOriginalUri) {\n    const err = new AuthSdkError('No restoreOriginalUri callback passed to Security Component.');\n    return <OktaError error={err} />;\n  }\n\n  if (!oktaAuth._oktaUserAgent) {\n    console.warn('_oktaUserAgent is not available on auth SDK instance. Please use okta-auth-js@^5.3.1 .');\n  }\n  else {\n    // use SKIP_VERSION_CHECK flag to control version check in tests\n    // OKTA-465157: remove SKIP_VERSION_CHECK\n    const isAuthJsSupported = SKIP_VERSION_CHECK === '1' ||\n      compareVersions(oktaAuth._oktaUserAgent.getVersion(), AUTH_JS.minSupportedVersion, '>=');\n    if (!isAuthJsSupported) {\n      const err = new AuthSdkError(`\n        Passed in oktaAuth is not compatible with the SDK,\n        minimum supported okta-auth-js version is ${AUTH_JS.minSupportedVersion}.\n      `);\n      return <OktaError error={err} />;\n    }\n  }\n\n  return (\n    <OktaContext.Provider value={{ \n      oktaAuth, \n      authState, \n      _onAuthRequired: onAuthRequired\n    }}>\n      {children}\n    </OktaContext.Provider>\n  );\n};\n\nexport default Security;\n","/*\n * Copyright (c) 2020-Present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport * as React from 'react';\nimport { useOktaAuth, IOktaContext } from './OktaContext';\n\nconst withOktaAuth = <P extends IOktaContext>(\n  ComponentToWrap: React.ComponentType<P>\n): React.FC<Omit<P, keyof IOktaContext>> => { \n  const WrappedComponent = (props: Omit<P, keyof IOktaContext>) => { \n    const oktaAuthProps = useOktaAuth();\n    return <ComponentToWrap {...oktaAuthProps as IOktaContext } {...props as P} />;\n  };\n  WrappedComponent.displayName = 'withOktaAuth_' + (ComponentToWrap.displayName || ComponentToWrap.name);\n  return WrappedComponent;\n};\n\nexport default withOktaAuth;\n"],"names":["useMatch","OktaContext","React","createContext","useOktaAuth","useContext","OktaError","_ref","error","name","message","createElement","toString","ReactRouterDom","AuthSdkError","errorComponent","_ref$loadingElement","loadingElement","onAuthResume","_useOktaAuth","oktaAuth","authState","_React$useState2","_slicedToArray","useState","callbackError","setCallbackError","ErrorReporter","useEffect","isInteractionRequired","idx","bind","handleLoginRedirect","e","authError","displayError","onAuthRequired","routeProps","_objectWithoutProperties","_excluded","_onAuthRequired","match","pendingLogin","useRef","handleLoginError","setHandleLoginError","handleLogin","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","originalUri","onAuthRequiredFn","wrap","_context","prev","next","current","abrupt","toRelativeUrl","window","location","href","origin","setOriginalUri","signInWithRedirect","stop","apply","this","arguments","isAuthenticated","err","Route","restoreOriginalUri","children","authStateManager","getAuthState","setAuthState","options","console","warn","_x","_x2","_oktaUserAgent","addEnvironment","currentAuthState","handler","subscribe","start","unsubscribe","compareVersions","compare","getVersion","concat","Provider","value","ComponentToWrap","WrappedComponent","props","oktaAuthProps","displayName"],"mappings":"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"}